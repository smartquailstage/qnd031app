
{% load widget_tweaks %}
{% load static %}



<header class="top-header">
  <nav class="navbar navbar-expand gap-3">
    <div class="toggle-icon">
      <ion-icon name="menu-outline"></ion-icon>
    </div>
  
<div class="top-navbar-left d-block d-sm-none" style="background-color: white;
    padding: 1px 0px;
    border-bottom-right-radius: 25px;
    border-bottom-left-radius: 25px;
    margin-top: 115px;">
  <a class="navbar-brand" href="#">
    <img src="{% static 'img/BA-LOGOS/logoF.png' %}" alt="Logo" style="height: 28px;margin-left: 12px;">
  </a>
</div>

<div class="top-navbar-right ms-auto">
  <ul class="navbar-nav align-items-center">

    <!-- Tareas Asignadas -->
<li class="nav-item dropdown dropdown-large">
  <a class="nav-link dropdown-toggle dropdown-toggle-nocaret" href="#" data-bs-toggle="dropdown">
    <div class="position-relative">
      {% if ultimos_videos_realizados|length > 0 %}
        <span class="notify-badge">{{ ultimos_videos_realizados|length }}</span>
      {% endif %}
      <ion-icon name="videocam-outline"></ion-icon>
    </div>
  </a>
  <div class="dropdown-menu dropdown-menu-end">
    <div class="msg-header d-flex align-items-center">
      <p class="msg-header-title mb-0">
        <ion-icon name="videocam-outline"></ion-icon> Videos de Terapia
      </p>
      <p class="msg-header-clear ms-auto mb-0 text-primary">
        {{ ultimos_videos_realizados|length }} nuevos
      </p>
    </div>
    <div class="header-notifications-list">
      {% for tarea in ultimos_videos_realizados %}
        <a class="dropdown-item" href="{% url 'usuarios:terapia_detail' tarea.id %}">
          <div class="d-flex align-items-center">
            {% if tarea.thumbnail_media %}
              <img src="{{ tarea.thumbnail_media.url }}" alt="Thumbnail" width="40" height="40" class="rounded me-2">
            {% else %}
              <div class="notify text-primary">
                <ion-icon name="play-circle-outline"></ion-icon>
              </div>
            {% endif %}
            <div class="flex-grow-1">
              <h6 class="msg-name">{{ tarea.titulo|default:"Sin título" }}</h6>
              <p class="msg-info">Fecha: {{ tarea.fecha_actividad|date:"d M Y H:i" }}</p>
            </div>
          </div>
        </a>
      {% empty %}
        <div class="dropdown-item text-center text-muted small">
          No hay videos recientes de terapia
        </div>
      {% endfor %}
    </div>
    <a href="{% url 'usuarios:terapia_list' %}">
      <div class="text-center msg-footer">
        <ion-icon name="film-outline"></ion-icon> Ver todas las terapias
      </div>
    </a>
  </div>
</li>


    <!-- Notificaciones -->
    <li class="nav-item dropdown dropdown-large">
      <a class="nav-link dropdown-toggle dropdown-toggle-nocaret" href="javascript:;" data-bs-toggle="dropdown">
        <div class="position-relative">
          {% if mensajes_nuevos > 0 %}
            <span class="notify-badge">{{ mensajes_nuevos }}</span>
          {% endif %}
          <ion-icon name="notifications-outline"></ion-icon>
        </div>
      </a>
      <div class="dropdown-menu dropdown-menu-end">
        <div class="msg-header d-flex align-items-center">
          <p class="msg-header-title mb-0"><ion-icon name="notifications-outline"></ion-icon> Notificaciones</p>
          <p class="msg-header-clear ms-auto mb-0 text-primary" style="cursor: pointer;">{{ mensajes_nuevos }} Nuevas, hace </p>
        </div>
        <div class="header-notifications-list">
          {% for mensaje in mensajes_recientes %}
            <a class="dropdown-item" href="{% url 'usuarios:ver_mensaje' mensaje.id %}">
              <div class="d-flex align-items-center">
                <div class="notify text-primary"><ion-icon name="mail-unread-outline"></ion-icon></div>
                <div class="flex-grow-1">
                  <h6 class="msg-name">
                    {{ mensaje.emisor.get_full_name }}
                    <span class="msg-time float-end">
                      {{ mensaje.fecha_envio|timesince }} 
                    </span>
                  </h6>
                  <p class="msg-info">Asunto: {{ mensaje.asunto |truncatechars:50 }}</p>
                </div>
              </div>
            </a>
          {% empty %}
            <div class="dropdown-item text-center text-muted small">
              No hay mensajes recientes
            </div>
          {% endfor %}
        </div>
        <a href="{% url 'usuarios:inbox' %}">
          <div class="text-center msg-footer"><ion-icon name="archive"></ion-icon> Bandeja de entrada</div>
        </a>
      </div>
    </li>

    <!-- Configuración del Usuario -->
    <li class="nav-item dropdown dropdown-user-setting">
      <a class="nav-link dropdown-toggle dropdown-toggle-nocaret" href="javascript:;" data-bs-toggle="dropdown">
        <div class="user-setting">
          {% if profile_photo %}
            <img src="{{ profile_photo }}" class="user-img" alt="Foto de perfil">
          {% else %}
            <img src="{% static 'img/BA-LOGOS/user.png' %}" style="width:30px;" alt="Default Photo">
          {% endif %}
        </div>
      </a>
      <ul class="dropdown-menu dropdown-menu-end">
        <li>
          <a class="dropdown-item" href="{% url 'usuarios:perfil' %}">
            <div class="d-flex flex-row align-items-center gap-2">
              {% if profile_photo %}
                <img src="{{ profile_photo }}" alt="Foto de perfil" class="rounded-circle" width="44" height="44">
              {% endif %}
              <div class="">
                <h6 class="mb-0 dropdown-user-name">{{ name }} {{ last_name }}</h6>
                <small class="mb-0 dropdown-user-designation text-secondary">Paciente MEDDES®</small>
              </div>
            </div>
          </a>
        </li>
        <li><hr class="dropdown-divider"></li>
        <li>
          <a class="dropdown-item" href="{% url 'usuarios:logout' %}">
            <div class="d-flex align-items-center">
              <div><ion-icon name="log-out-outline"></ion-icon></div>
              <div class="ms-3"><span>Salir</span></div>
            </div>
          </a>
        </li>
      </ul>
    </li>

  </ul>
</div>

  </nav>
</header>

   
      <!--end top header-->