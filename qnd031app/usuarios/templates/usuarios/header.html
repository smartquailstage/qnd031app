
{% load widget_tweaks %}
{% load static %}



<header class="top-header">
  <nav class="navbar navbar-expand gap-3">
    <div class="toggle-icon">
      <ion-icon name="menu-outline"></ion-icon>
    </div>
  
    <div class="top-navbar-right ms-auto">

      <ul class="navbar-nav align-items-center">
         <li class="nav-item dropdown dropdown-large">
          <a class="nav-link dropdown-toggle dropdown-toggle-nocaret" href="javascript:;" data-bs-toggle="dropdown">
            <div class="position-relative">
              <span class="notify-badge">8</span>
              <ion-icon name="wallet-outline"></ion-icon>
            </div>
          </a>
          <div class="dropdown-menu dropdown-menu-end">
            <a href="javascript:;">
              <div class="msg-header">
                <p class="msg-header-title">Notifications</p>
                <p class="msg-header-clear ms-auto">Marks all as read</p>
              </div>
            </a>
            <div class="header-notifications-list">
              <a class="dropdown-item" href="javascript:;">
                <div class="d-flex align-items-center">
                  <div class="notify text-primary">
                    <ion-icon name="cart-outline"></ion-icon>
                  </div>
                  <div class="flex-grow-1">
                    <h6 class="msg-name">New Orders <span class="msg-time float-end">2 min
                        ago</span></h6>
                    <p class="msg-info">You have recived new orders</p>
                  </div>
                </div>
              </a>
              <a class="dropdown-item" href="javascript:;">
                <div class="d-flex align-items-center">
                  <div class="notify text-danger">
                    <ion-icon name="person-outline"></ion-icon>
                  </div>
                  <div class="flex-grow-1">
                    <h6 class="msg-name">New Customers<span class="msg-time float-end">14 Sec
                        ago</span></h6>
                    <p class="msg-info">5 new user registered</p>
                  </div>
                </div>
              </a>
              <a class="dropdown-item" href="javascript:;">
                <div class="d-flex align-items-center">
                  <div class="notify text-success">
                    <ion-icon name="document-outline"></ion-icon>
                  </div>
                  <div class="flex-grow-1">
                    <h6 class="msg-name">24 PDF File<span class="msg-time float-end">19 min
                        ago</span></h6>
                    <p class="msg-info">The pdf files generated</p>
                  </div>
                </div>
              </a>

              <a class="dropdown-item" href="javascript:;">
                <div class="d-flex align-items-center">
                  <div class="notify text-info">
                    <ion-icon name="checkmark-done-outline"></ion-icon>
                  </div>
                  <div class="flex-grow-1">
                    <h6 class="msg-name">New Product Approved <span class="msg-time float-end">2 hrs ago</span></h6>
                    <p class="msg-info">Your new product has approved</p>
                  </div>
                </div>
              </a>
              <a class="dropdown-item" href="javascript:;">
                <div class="d-flex align-items-center">
                  <div class="notify text-warning">
                    <ion-icon name="send-outline"></ion-icon>
                  </div>
                  <div class="flex-grow-1">
                    <h6 class="msg-name">Time Response <span class="msg-time float-end">28 min
                        ago</span></h6>
                    <p class="msg-info">5.1 min avarage time response</p>
                  </div>
                </div>
              </a>
              <a class="dropdown-item" href="javascript:;">
                <div class="d-flex align-items-center">
                  <div class="notify text-danger">
                    <ion-icon name="chatbox-ellipses-outline"></ion-icon>
                  </div>
                  <div class="flex-grow-1">
                    <h6 class="msg-name">New Comments <span class="msg-time float-end">4 hrs
                        ago</span></h6>
                    <p class="msg-info">New customer comments recived</p>
                  </div>
                </div>
              </a>
              <a class="dropdown-item" href="javascript:;">
                <div class="d-flex align-items-center">
                  <div class="notify text-primary">
                    <ion-icon name="albums-outline"></ion-icon>
                  </div>
                  <div class="flex-grow-1">
                    <h6 class="msg-name">New 24 authors<span class="msg-time float-end">1 day
                        ago</span></h6>
                    <p class="msg-info">24 new authors joined last week</p>
                  </div>
                </div>
              </a>
              <a class="dropdown-item" href="javascript:;">
                <div class="d-flex align-items-center">
                  <div class="notify text-success">
                    <ion-icon name="shield-outline"></ion-icon>
                  </div>
                  <div class="flex-grow-1">
                    <h6 class="msg-name">Your item is shipped <span class="msg-time float-end">5 hrs
                        ago</span></h6>
                    <p class="msg-info">Successfully shipped your item</p>
                  </div>
                </div>
              </a>
              <a class="dropdown-item" href="javascript:;">
                <div class="d-flex align-items-center">
                  <div class="notify text-warning">
                    <ion-icon name="cafe-outline"></ion-icon>
                  </div>
                  <div class="flex-grow-1">
                    <h6 class="msg-name">Defense Alerts <span class="msg-time float-end">2 weeks
                        ago</span></h6>
                    <p class="msg-info">45% less alerts last 4 weeks</p>
                  </div>
                </div>
              </a>
            </div>
            <a href="javascript:;">
              <div class="text-center msg-footer">View All Notifications</div>
            </a>
          </div>
        </li>
<li class="nav-item dropdown dropdown-large">
  <a class="nav-link dropdown-toggle dropdown-toggle-nocaret" href="#" data-bs-toggle="dropdown">
    <div class="position-relative">
      {% if tareas_nuevas_count > 0 %}
        <span class="notify-badge">{{ tareas_nuevas_count }}</span>
      {% endif %}
      <ion-icon name="clipboard-outline"></ion-icon>
    </div>
  </a>

  <div class="dropdown-menu dropdown-menu-end">
    <div class="msg-header d-flex align-items-center">
      <p class="msg-header-title mb-0"><ion-icon name="clipboard-outline"></ion-icon> Tareas Asignadas</p>
      <p class="msg-header-clear ms-auto mb-0 text-primary">{{ tareas_nuevas_count }} nuevas</p>
    </div>

    <div class="header-notifications-list">
      {% for tarea in tareas_detalle %}
        <a class="dropdown-item" href="{% url 'usuarios:ver_tarea' tarea.id %}">
          <div class="d-flex align-items-center">
            <div class="notify text-warning"><ion-icon name="document-text-outline"></ion-icon></div>
            <div class="flex-grow-1">
              <h6 class="msg-name">{{ tarea.titulo|default:"Sin título" }}</h6>
              <p class="msg-info">Entrega: {{ tarea.fecha_entrega|date:"d M Y" }}</p>
            </div>
          </div>
        </a>
      {% empty %}
        <div class="dropdown-item text-center text-muted small">
          No tienes tareas pendientes
        </div>
      {% endfor %}
    </div>

    <a href="{% url 'usuarios:lista_tareas' %}">
      <div class="text-center msg-footer"><ion-icon name="list-circle-outline"></ion-icon> Ver todas las tareas</div>
    </a>
  </div>
</li>

<li class="nav-item dropdown dropdown-large">
  <a class="nav-link dropdown-toggle dropdown-toggle-nocaret" href="javascript:;" data-bs-toggle="dropdown">
    <div class="position-relative">
      {% if citas_pendientes_count > 0 %}
        <span class="notify-badge">{{ citas_pendientes_count }}</span>
      {% endif %}
      <ion-icon name="calendar-outline"></ion-icon>
    </div>
  </a>

  <div class="dropdown-menu dropdown-menu-end">
    <div class="msg-header d-flex align-items-center">
      <p class="msg-header-title mb-0">
        <ion-icon name="calendar-outline"></ion-icon> Citas Médicas
      </p>
      <p class="msg-header-clear ms-auto mb-0 text-primary">
        {{ citas_pendientes_count }} Pendientes
      </p>
    </div>

    <div class="header-notifications-list">
      {% for cita in citas_todas|slice:":2" %}
        <a class="dropdown-item" href="{% url 'usuarios:ver_cita' cita.id %}"> 
          <div class="d-flex align-items-center">
            <div class="notify {% if cita.estado == 'pendiente' %}text-warning{% elif cita.estado == 'confirmada' %}text-success{% else %}text-danger{% endif %}">
              <ion-icon name="medkit-outline"></ion-icon>
            </div>
            <div class="flex-grow-1">
              <h6 class="msg-name">
                {{ cita.motivo|truncatechars:40 }}
                <span class="msg-time float-end">
                  {{ cita.fecha|date:"d M Y H:i" }}
                </span>
              </h6>
              <p class="msg-info">Estado: {{ cita.estado|capfirst }}</p>
            </div>
          </div>
        </a>
      {% empty %}
        <div class="dropdown-item text-center text-muted small">
          No hay citas registradas
        </div>
      {% endfor %}
    </div>

    <a href="{% url 'usuarios:citas_total' %}">
      <div class="text-center msg-footer">
        <ion-icon name="list-circle-outline"></ion-icon> Ver todas las citas
      </div>
    </a>
  </div>
</li>

<li class="nav-item dropdown dropdown-large">
  <a class="nav-link dropdown-toggle dropdown-toggle-nocaret" href="javascript:;" data-bs-toggle="dropdown">
    <div class="position-relative">
      {% if mensajes_nuevos > 0 %}
        <span class="notify-badge">{{ mensajes_nuevos }}</span>
      {% endif %}
      <ion-icon name="notifications-outline"></ion-icon>
    </div>
  </a>

  <div class="dropdown-menu dropdown-menu-end">
    <div class="msg-header d-flex align-items-center">
      <p class="msg-header-title mb-0"><ion-icon name="notifications-outline"></ion-icon> Notificaciones</p>
      <p class="msg-header-clear ms-auto mb-0 text-primary" style="cursor: pointer;">{{ mensajes_nuevos }} Nuevas, hace </p>
    </div>

    <div class="header-notifications-list">
      {% for mensaje in mensajes_recientes %}
        <a class="dropdown-item" href="{% url 'usuarios:ver_mensaje' mensaje.id %}">
          <div class="d-flex align-items-center">
            <div class="notify text-primary">
              <ion-icon name="mail-unread-outline"></ion-icon>
            </div>
            <div class="flex-grow-1">
              <h6 class="msg-name">
                {{ mensaje.emisor.get_full_name }}
                <span class="msg-time float-end">
                  {{ mensaje.fecha_envio|timesince }} 
                </span>
              </h6>
              <p class="msg-info">Asunto: {{ mensaje.asunto |truncatechars:50 }}</p>
            </div>
          </div>
        </a>
      {% empty %}
        <div class="dropdown-item text-center text-muted small">
          No hay mensajes recientes
        </div>
      {% endfor %}
    </div>

      <a href="{% url 'usuarios:inbox' %}">
              <div class="text-center msg-footer"><ion-icon name="archive"></ion-icon> Bandeja de entrada</div>
      </a>
  </div>
</li>

<li class="nav-item dropdown dropdown-user-setting">
  <a class="nav-link dropdown-toggle dropdown-toggle-nocaret" href="javascript:;" data-bs-toggle="dropdown">
    <div class="user-setting ">
      {% if profile_photo %}
        <img src="{{ profile_photo }}" class="user-img" alt="Foto de perfil">
      {% endif %}
    </div>
  </a>
  <ul class="dropdown-menu dropdown-menu-end">
    <li>
      <a class="dropdown-item" href="javascript:;">
        <div class="d-flex  flex-row  align-items-center gap-2">
          {% if profile_photo %}
            <img src="{{ profile_photo }}" alt="Foto de perfil" class="rounded-circle" width="44" height="44">
          {% endif %}
          <div class="">
            <h6 class="mb-0 dropdown-user-name">{{ name }} {{ last_name }}</h6>
            <small class="mb-0 dropdown-user-designation text-secondary">Paciente MEDDES®</small>
          </div>
        </div>
      </a>
    </li>
    <li><hr class="dropdown-divider"></li>
    <li>
      <a class="dropdown-item" href="{% url 'usuarios:perfil' %}">
        <div class="d-flex align-items-center">
          <div><ion-icon name="person-outline"></ion-icon></div>
          <div class="ms-3"><span>Perfil</span></div>
        </div>
      </a>
    </li>
    <li><hr class="dropdown-divider"></li>
    <li>
      <a class="dropdown-item" href="{% url 'logout' %}">
        <div class="d-flex align-items-center">
          <div><ion-icon name="log-out-outline"></ion-icon></div>
          <div class="ms-3"><span>Salir</span></div>
        </div>
      </a>
    </li>
  </ul>
</li>


      </ul>

    </div>
  </nav>
</header>

   
      <!--end top header-->