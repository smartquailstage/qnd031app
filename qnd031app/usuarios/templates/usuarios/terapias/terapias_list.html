{% extends "base_dash.html" %}
{% load static %}

{% block content %}

<link href="{% static 'assets/plugins/datetimepicker/css/classic.css' %}" rel="stylesheet" />
<link href="{% static 'assets/plugins/datetimepicker/css/classic.time.css' %}" rel="stylesheet" />
<link href="{% static 'assets/plugins/datetimepicker/css/classic.date.css' %}" rel="stylesheet" />

<style>
  .gris-oscuro {
    background-color: #343a40;
    color: white;
  }
</style>

<div class="page-content-wrapper">
  <div class="page-content">

    <div class="row">
      <div class="col-12 col-lg-8 col-xl-12">
        <div class="card overflow-hidden radius-10">
          <div class="profile-cover-1 bg-dark position-relative mb-4">
            <div class="user-profile-avatar position-absolute top-50 start-0 translate-middle-x">
              <img src="{% static 'assets/meddes/terapias_avatar.png' %}" alt="User Photo">
            </div>
          </div>

          <div class="card-body text-left">
            <div class="col-12 col-md-6 mx-auto">
              <div class="card mb-4">
                <div class="card-body">
                  <h2 class="font-weight-bold display-4" style="color:#45a851;">TERAPIAS</h2>
                  <h4 class="mb-4">Acceda a sus terapias realizadas, en tiempo real.</h4>



                  <!-- Video destacado -->
                  {% if media and media.media_terapia %}
                    <figure class="text-center">
                      <a href="{{ media.media_terapia.url }}" target="_blank" class="text-decoration-none position-relative d-inline-block">
                        {% if media.thumbnail_media %}
                          <img src="{{ media.thumbnail_media.url }}"
                               alt="PrevisualizaciÃ³n del video"
                               class="img-thumbnail shadow-sm"
                               style="width: 560px; height: 195px; object-fit: cover;">
                        {% else %}
                          <img src="{% static 'img/default_video_thumb.jpg' %}"
                               alt="Sin miniatura"
                               class="img-thumbnail shadow-sm"
                               style="width: 560px; height: 195px; object-fit: cover;">
                        {% endif %}
                        <span class="position-absolute top-50 start-50 translate-middle bg-white text-dark rounded-circle p-2 shadow" style="font-size: 1.5rem;">
                          <i class="bi bi-play-fill"></i>
                        </span>
                      </a>
                      <figcaption class="mt-2 small text-muted">Haz clic para ver el video</figcaption>
                    </figure>
                  {% else %}
                    <div class="alert alert-warning mt-3">No hay video disponible para mostrar.</div>
                  {% endif %}


                                    <!-- Formulario de filtro -->
                  <form method="get" class="row g-2 mb-4" id="date-filter-form">
                    <div class="col-6">
                      <label for="mes" class="form-label"></label>
                      <select name="mes" id="mes" class="form-select">
                        {% for numero, nombre in meses %}
                          <option value="{{ numero }}" {% if numero == mes %}selected{% endif %}>{{ nombre }}</option>
                        {% endfor %}
                      </select>
                    </div>

                    <div class="col-6">
                      <label for="anio" class="form-label"></label>
                      <select name="anio" id="anio" class="form-select">
                        {% for a in anios %}
                          <option value="{{ a }}" {% if a == anio %}selected{% endif %}>{{ a }}</option>
                        {% endfor %}
                      </select>
                    </div>

                    <div class="col-md-4 d-flex align-items-end">
                      <button type="submit" class="btn btn-success w-100"><ion-icon name="search-outline"></ion-icon> Buscar Terapias</button>
                    </div>
                  </form>

                  <!-- Tabla de terapias -->
<div style="max-height: 300px; overflow-y: auto;">
  <table class="table mb-0 table-dark table-striped">
    <tbody>
      {% for actividad in actividades %}
        <tr onclick="window.location.href='{% url 'usuarios:terapia_detail' actividad.pk %}'" style="cursor: pointer;">
          <!-- COLUMNA: NUEVA -->
          <td style="background-color: {% if actividad.es_nueva %}#198754{% else %}#6c757d{% endif %}; color: white; font-weight: bold;">
            {% if actividad.es_nueva %}
              NUEVA
            {% else %}
              -
            {% endif %}
          </td>

          <!-- COLUMNAS ORIGINALES -->
          <td style="background-color: #6c757d;">{{ actividad.cita_terapeutica_asignada|date:"d/m/Y" }}</td>

          <td style="background-color: #343a40;">
            {% if actividad.terapeuta %}
              {{ actividad.terapeuta.get_full_name }}
            {% else %}
              <em>Sin terapeuta</em>
            {% endif %}
          </td>

          <td style="background-color: #495057;">{{ actividad.sucursal }}</td>
        </tr>
      {% empty %}
        <tr>
          <td colspan="5" class="text-center">No hay actividades registradas para este mes.</td>
        </tr>
      {% endfor %}
    </tbody>
  </table>
</div>


                </div> <!-- card-body -->
              </div> <!-- card -->
            </div> <!-- col -->
          </div> <!-- card-body -->

        </div> <!-- card -->
      </div> <!-- col -->
    </div> <!-- row -->

  </div> <!-- page-content -->
</div> <!-- wrapper -->

{% endblock %}
